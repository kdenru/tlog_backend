# TLOG Backend

## Описание

Бэкенд на Fastify + TypeScript + Prisma для игры с раундами, тапами и авторизацией через JWT.

## Переменные окружения

```
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
JWT_SECRET=секрет_для_jwt
ROUND_DURATION=60         # длительность раунда в минутах
COOLDOWN_DURATION=30      # время ожидания перед стартом раунда в секундах
PORT=3000
```

---

## Бизнес-логика

- **Пользователь** может быть с ролью: `admin`, `nikita`, `survivor`.
- **Регистрация/логин** — через `/login`, выдается JWT с ролью.
- **Раунд** — имеет дату старта, окончания, и создаётся только админом.
- **Тап** — нажатие пользователя в рамках раунда.
- **UserStat** — статистика пользователя по раунду (очки, количество тапов).

### Правила начисления очков:
- 1 тап = 1 очко.
- Каждый 11-й тап = 10 очков.
- Тапать можно только в активном раунде (между startAt и endAt).
- Если выживший с username "nikita" — его очки всегда 0, но тап создаётся.

---

## Роуты

### Аутентификация

#### POST `/login`
- **Описание:** Регистрация или логин пользователя.
- **Тело запроса:**  
  ```json
  { "username": "имя", "password": "пароль" }
  ```
- **Ответ:**  
  ```json
  { "id": 1, "username": "имя", "role": "survivor", "token": "..." }
  ```

---

### Раунды

#### POST `/rounds`
- **Описание:** Создать новый раунд (только для admin).
- **Заголовок:**  
  `Authorization: Bearer <jwt>`
- **Ответ:**  
  ```json
  { "id": "...", "startAt": "...", "endAt": "...", ... }
  ```

#### GET `/rounds`
- **Описание:** Получить список всех раундов.
- **Ответ:**  
  ```json
  [ { "id": "...", "startAt": "...", "endAt": "...", ... }, ... ]
  ```

#### GET `/rounds/:id`
- **Описание:** Получить инфу по раунду, победителя (если завершён) и свои очки.
- **Заголовок:**  
  `Authorization: Bearer <jwt>`
- **Ответ:**  
  ```json
  {
    "id": "...",
    "startAt": "...",
    "endAt": "...",
    "winner": { "userId": 1, "points": 42 },
    "myPoints": 17,
    ...
  }
  ```

---

### Тапы

#### POST `/taps`
- **Описание:** Сделать тап (нажатие) в раунде.
- **Заголовок:**  
  `Authorization: Bearer <jwt>`
- **Тело запроса:**  
  ```json
  { "roundId": "uuid", "points": 1 }
  ```
- **Ответ:**  
  ```json
  { "myPoints": 18 }
  ```

---